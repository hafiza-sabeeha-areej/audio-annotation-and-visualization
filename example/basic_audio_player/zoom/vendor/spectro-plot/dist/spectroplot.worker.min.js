/*! For license information please see spectroplot.worker.min.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var s=e();for(var a in s)("object"==typeof exports?exports:t)[a]=s[a]}}(self,(function(){return function(){var t={"./lib/fft_nayuki.js":function(t,e,s){"use strict";s.r(e);e.default=class{constructor(t){this.n=t,this.levels=-1;for(let e=0;e<32;e++)1<<e==t&&(this.levels=e);if(-1==this.levels)throw"Length is not a power of 2";this.cosTable=new Array(t/2),this.sinTable=new Array(t/2);for(let e=0;e<t/2;e++)this.cosTable[e]=Math.cos(2*Math.PI*e/t),this.sinTable[e]=Math.sin(2*Math.PI*e/t)}transform(t,e){const s=this.n;for(let i=0;i<s;i++){const s=a(i,this.levels);if(s>i){let a=t[i];t[i]=t[s],t[s]=a,a=e[i],e[i]=e[s],e[s]=a}}for(let a=2;a<=s;a*=2){const i=a/2,r=s/a;for(let n=0;n<s;n+=a)for(let s=n,a=0;s<n+i;s++,a+=r){const r=s+i,n=t[r]*this.cosTable[a]+e[r]*this.sinTable[a],o=-t[r]*this.sinTable[a]+e[r]*this.cosTable[a];t[r]=t[s]-n,e[r]=e[s]-o,t[s]+=n,e[s]+=o}}function a(t,e){let s=0;for(let a=0;a<e;a++)s=s<<1|1&t,t>>>=1;return s}}splitreal(t,e){const s=this.n;e[0]=0,t[s/2]=e[0],e[s/2]=0;for(let a=1;a<s/2;a+=1){const i=.5*(t[a]+t[s-a]),r=.5*(e[a]-e[s-a]),n=.5*(e[a]+e[s-a]),o=.5*(-t[a]+t[s-a]);t[a]=i,e[a]=r,t[s-a]=n,e[s-a]=o}}}},"./lib/polyfill.js":function(){Object.assign||(Object.assign=function(t,...e){return e.reduce((function(t,e){return Object.keys(e).forEach((function(s){t[s]=e[s]})),t}),t)}),Math.clamp||(Math.clamp=function(t,e,s){return Math.max(e,Math.min(t,s))}),Math.log10||(Math.log10=function(t){return Math.log(t)*Math.LOG10E}),Math.log2||(Math.log2=function(t){return Math.log(t)*Math.LOG2E}),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(t){if(null==this)throw new TypeError("this is null or not defined");for(var e=Object(this),s=e.length>>>0,a=arguments[1],i=a>>0,r=i<0?Math.max(s+i,0):Math.min(i,s),n=arguments[2],o=void 0===n?s:n>>0,l=o<0?Math.max(s+o,0):Math.min(o,s);r<l;)e[r]=t,r++;return e}})},"./lib/samples.js":function(t,e,s){"use strict";s.r(e);e.default=class{constructor(t,e,s,a){let i,r,n,o;this.sampleRate=s||25e4,this.centerFreq=a||0,t=t.toUpperCase(),this.format=t,"CU4"==t?(r=7.5,n=1/7.5,o=1,i=Uint8Array,this.sampleI=this.unpackI_CU4,this.sampleQ=this.unpackQ_CU4):"CS4"==t?(r=0,n=1/8,o=1,i=Uint8Array,this.sampleI=this.unpackI_CS4,this.sampleQ=this.unpackQ_CS4):"CU8"==t||"DATA"==t||"COMPLEX16U"==t?(r=127.5,n=1/127.5,o=2,i=Uint8Array):"CS8"==t||"COMPLEX16S"==t?(r=0,n=1/128,o=2,i=Int8Array):"CU16"==t?(r=32767.5,n=1/32768,o=4,i=Uint16Array):"CS16"==t?(r=0,n=1/32768,o=4,i=Int16Array):"CU12"==t?(r=2047.5,n=1/2047.5,o=3,i=Uint8Array,this.sampleI=this.unpackI_CU12,this.sampleQ=this.unpackQ_CU12):"CS12"==t?(r=0,n=1/2048,o=3,i=Uint8Array,this.sampleI=this.unpackI_CS12,this.sampleQ=this.unpackQ_CS12):"CU32"==t?(r=2147483647.5,n=1/2147483648,o=8,i=Uint32Array):"CS32"==t?(r=0,n=1/2147483648,o=8,i=Int32Array):"CU64"==t?(r=1,n=1,o=16,i=Uint32Array,this.sampleI=this.unpackI_CU64,this.sampleQ=this.unpackQ_CU64):"CS64"==t?(r=0,n=1,o=16,i=Uint32Array,this.sampleI=this.unpackI_CS64,this.sampleQ=this.unpackQ_CS64):"CF32"==t||"CFILE"==t||"COMPLEX"==t?(r=0,n=1,o=8,i=Float32Array):"CF64"==t?(r=0,n=1,o=16,i=Float64Array):"WAV"==t||"BWF"==t||"WEBM"==t||"OGG"==t||"OPUS"==t||"FLAC"==t||"MP4"==t||"M4A"==t||"AAC"==t||"MP3"==t?(e=null,o=8,this.sampleI=this.unpackI_audio,this.sampleQ=this.unpackQ_audio,this.format="CF32"):(r=127.5,n=1/127.5,o=2,i=Uint8Array),this.sampleBias=r,this.sampleScale=n,this.sampleWidth=o,this.typedArray=i,e&&(this.buffer=e,this.view=new i(e),this.sampleCount=e.byteLength/this.sampleWidth)}loadBuffer(t){return this.typedArray?(this.buffer=t,this.view=new this.typedArray(t),this.sampleCount=t.byteLength/this.sampleWidth,Promise.resolve()):this.readAudio(t)}amplitude_cu8(){const t=new Uint16Array(this.sampleCount);for(let e=0;e<this.sampleCount;e++){let s=127-this.view[2*e],a=127-this.view[2*e+1];t[e]=s*s+a*a}return t}magnitude_est_cu8(){const t=new Uint16Array(this.sampleCount);for(let e=0;e<this.sampleCount;e++){let s=Math.abs(this.view[2*e]-128),a=Math.abs(this.view[2*e+1]-128),i=122*(s>a?s:a)+51*(s<a?s:a);t[e]=i}return t}magnitude_true_cu8(){const t=new Uint16Array(this.sampleCount);for(let e=0;e<this.sampleCount;e++){let s=this.view[2*e]-128,a=this.view[2*e+1]-128;t[e]=128*Math.sqrt(s*s+a*a)}return t}magnitude_est_cs16(){const t=new Uint16Array(this.sampleCount);for(let e=0;e<this.sampleCount;e++){let s=Math.abs(this.view[2*e]),a=Math.abs(this.view[2*e+1]),i=122*(s>a?s:a)+51*(s<a?s:a);t[e]=i>>8}return t}magnitude_true_cs16(){const t=new Uint16Array(this.sampleCount);for(let e=0;e<this.sampleCount;e++){let s=this.view[2*e],a=this.view[2*e+1];t[e]=Math.sqrt(s*s+a*a)>>1}return t}get duration(){return this.sampleCount/this.sampleRate}slice(t,e,s,a){s=s||0,a=a||~~this.sampleCount;const i=this.sampleWidth*~~((a-s)/e);return this.buffer.slice(s*this.sampleWidth+i*t,s*this.sampleWidth+i*(t+1))}readAudio(t){return(new(window.AudioContext||window.webkitAudioContext)).decodeAudioData(t).then((t=>{this.audioBuffer=t,this.sampleCount=t.length,this.sampleRate=t.sampleRate,this.view=this.interleaved(),this.buffer=this.view.buffer})).catch((t=>{if(!this.audioBuffer)throw`decodeAudioData error: ${t}`}))}interleaved(){if(!this.audioBuffer)throw console.error("AudioBuffer not initialized"),"AudioBuffer not initialized";if(this.audioBuffer.numberOfChannels<1)throw console.error(`AudioBuffer wrong numberOfChannels (${this.audioBuffer.numberOfChannels})`),`AudioBuffer wrong numberOfChannels (${this.audioBuffer.numberOfChannels})`;1==this.audioBuffer.numberOfChannels&&console.warn("AudioBuffer is mono, duplicating channel to stereo"),this.audioBuffer.numberOfChannels>2&&console.warn(`AudioBuffer has too many channels (${this.audioBuffer.numberOfChannels}), using first two`);const t=this.sampleCount,e=new Float32Array(2*t),s=this.audioBuffer.getChannelData(0),a=this.audioBuffer.numberOfChannels>1?this.audioBuffer.getChannelData(1):this.audioBuffer.getChannelData(0);for(let i=0;i<t;i+=1)e[2*i+0]=s[i],e[2*i+1]=a[i];return e}unpackI_audio(t){return this.audioBuffer.getChannelData(0)[t]}unpackQ_audio(t){return this.audioBuffer.getChannelData(1)[t]}unpackI_CU4(t){return(((240&this.view[1*t+0])>>4)-this.sampleBias)*this.sampleScale}unpackQ_CU4(t){return(((15&this.view[1*t+0])>>0)-this.sampleBias)*this.sampleScale}unpackI_CS4(t){return((240&this.view[1*t+0])<<24>>28)*this.sampleScale}unpackQ_CS4(t){return((15&this.view[1*t+0])<<28>>28)*this.sampleScale}unpackI_CU12(t){const e=this.view[3*t+0];return(((15&this.view[3*t+1])<<8|e)-this.sampleBias)*this.sampleScale}unpackQ_CU12(t){const e=this.view[3*t+1];return((this.view[3*t+2]<<4|(240&e)>>4)-this.sampleBias)*this.sampleScale}unpackI_CS12(t){const e=this.view[3*t+0];return(((15&this.view[3*t+1])<<28|e<<20)>>20)*this.sampleScale}unpackQ_CS12(t){const e=this.view[3*t+1];return((this.view[3*t+2]<<24|(240&e)<<16)>>20)*this.sampleScale}unpackI_CU64(t){const e=this.view[4*t+0];return this.view[4*t+1]/2**31+e/2**64-this.sampleBias}unpackQ_CU64(t){const e=this.view[4*t+2];return this.view[4*t+3]/2**31+e/2**64-this.sampleBias}unpackI_CS64(t){const e=this.view[4*t+0];return(this.view[4*t+1]>>0)/2**31+e/2**64}unpackQ_CS64(t){const e=this.view[4*t+2];return(this.view[4*t+3]>>0)/2**31+e/2**64}sampleI(t){return(this.view[2*t+0]-this.sampleBias)*this.sampleScale}sampleQ(t){return(this.view[2*t+1]-this.sampleBias)*this.sampleScale}}}},e={};function s(a){var i=e[a];if(void 0!==i)return i.exports;var r=e[a]={exports:{}};return t[a](r,r.exports,s),r.exports}s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,{a:e}),e},s.d=function(t,e){for(var a in e)s.o(e,a)&&!s.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};return function(){"use strict";s.r(a);s("./lib/polyfill.js");var t=s("./lib/samples.js"),e=s("./lib/fft_nayuki.js");let i,r;onmessage=function(s){if(s.data&&s.data.buffer&&(self.performance&&performance.mark("render-start"),function(s){const a=new t.default(s.format,s.buffer),n=new Uint8ClampedArray(new ArrayBuffer(s.width)),o=new Uint8ClampedArray(new ArrayBuffer(s.width)),l=new Uint8ClampedArray(new ArrayBuffer(s.width)),u=a.sampleCount,h=s.block_norm,f=10*Math.log10(h),c=s.gain,p=s.range;let m=0,d=-200;const w=s.cmap,C=w.length-1,y=w.length/-p,v=1e3,b=new Array(v).fill(0),A=new Array(w.length).fill(0),g=s.n,_=s.windowc,M=g,B=s.width,U=(u-g)/(B-1),k=s.waterfall,S={data:new Uint8ClampedArray(4*B*M)};i!=g&&(r=new e.default(g),i=g);const I=new Array(g),O=new Array(g);for(let t=0;t<B;t++){for(let e=0;e<g;e++){const s=~~(.5+U*t)+e;I[e]=_[e]*a.sampleI(s),O[e]=_[e]*a.sampleQ(s)}r.transform(I,O),s.channelMode&&r.splitreal(I,O);let e=0,i=-200;for(let s=0;s<g;s++){const a=s<=g/2?g/2-s:g/2+g-s,r=I[s]*I[s]+O[s]*O[s];let n=5*Math.log10(r)+f+c;n-c<e&&(e=n-c),n-c>i&&(i=n-c);const o=~~(.5+-10*(n-c));b[o>=v?999:o]+=1;const l=C-n*y,u=~~(.5+(l<0?0:l>C?C:l));A[u]+=1;const h=w[u],p=k?M*(B-1-t)*4+4*(g-1-a):4*t+B*a*4;S.data[p+0]=h[0],S.data[p+1]=h[1],S.data[p+2]=h[2],S.data[p+3]=255}e<m&&(m=e),i>d&&(d=i),n[t]=.5+256*(p+e)/p,o[t]=.5+256*(p+i)/p;const u=~~(.5+U*t)+g/2,h=a.sampleI(u),Q=a.sampleQ(u),j=h*h+Q*Q;let x=5*Math.log10(j)+c;l[t]=.5+256*(p+x)/p}postMessage({cB_hist:b,c_hist:A,dBfs_min:m,dBfs_max:d,offset:s.offset,gauge_mins:n,gauge_maxs:o,gauge_amps:l,imageData:S},[n.buffer,o.buffer,l.buffer,S.data.buffer])}(s.data),self.performance)){performance.mark("render-end"),performance.measure("render","render-start","render-end");var a=performance.getEntriesByName("render")[0];console.log(`worker render: ${a.duration.toFixed(2)}ms`),performance.clearMarks(),performance.clearMeasures()}}}(),a}()}));
//# sourceMappingURL=spectroplot.worker.min.js.map